# 性能分析工具

> 使用工具分析和优化 Python 应用性能

## 1. cProfile

### 1.1 基础使用

```python
import cProfile
import pstats

def slow_function():
    total = 0
    for i in range(1000000):
        total += i
    return total

# 性能分析
profiler = cProfile.Profile()
profiler.enable()
slow_function()
profiler.disable()

# 查看结果
stats = pstats.Stats(profiler)
stats.sort_stats('cumulative')
stats.print_stats(10)  # 显示前10个
```

### 1.2 命令行使用

```bash
python -m cProfile -o profile.stats script.py
python -m pstats profile.stats
```

## 2. line_profiler

### 2.1 行级分析

```python
# 安装: pip install line_profiler

@profile
def slow_function():
    total = 0
    for i in range(1000000):
        total += i
    return total

# 运行: kernprof -l -v script.py
```

## 3. memory_profiler

### 3.1 内存分析

```python
# 安装: pip install memory-profiler

@profile
def memory_intensive():
    data = [i for i in range(1000000)]
    return sum(data)

# 运行: python -m memory_profiler script.py
```

## 4. py-spy

### 4.1 实时分析

```bash
# 安装
pip install py-spy

# 实时分析
py-spy record -o profile.svg --pid 12345

# 查看实时统计
py-spy top --pid 12345
```

## 5. 总结

性能分析工具：
- **cProfile**：函数级性能分析
- **line_profiler**：行级性能分析
- **memory_profiler**：内存使用分析
- **py-spy**：实时性能分析

使用这些工具可以快速定位性能瓶颈。

