# 数据可视化

## 1. 数据可视化概述

数据可视化是将数据透视的结果通过可视化的方式呈现出来，简单的说，就是将数据变成漂亮的统计图表。人类对颜色和形状会更加敏感，通过可视化可以更直观地解读数据背后隐藏的商业价值。

### 1.1 常用图表类型

选择合适的图表类型对于数据可视化非常重要：

- **折线图**：看趋势
- **柱状图**：比数据
- **散点图**：定关系
- **饼图**：查占比
- **直方图**：看分布
- **箱线图**：找离群

## 2. Matplotlib基础

### 2.1 安装和导入

```bash
pip install matplotlib
```

```python
import matplotlib.pyplot as plt
import numpy as np
```

### 2.2 中文显示配置

```python
plt.rcParams['font.sans-serif'].insert(0, 'SimHei')
plt.rcParams['axes.unicode_minus'] = False
```

### 2.3 创建画布和坐标系

```python
# 创建画布
plt.figure(figsize=(8, 4), dpi=120)

# 创建坐标系
plt.subplot(2, 2, 1)  # 2行2列，第1个图
```

## 3. 基本图表绘制

### 3.1 折线图

折线图最适合用来观察数据的趋势，尤其是当横坐标代表时间的情况下。

```python
x = np.linspace(-2 * np.pi, 2 * np.pi, 120)
y = np.sin(x)

plt.figure(figsize=(8, 4), dpi=120)
plt.plot(x, y, linewidth=2, marker='*', color='red', label='sin(x)')
plt.xlabel('X轴')
plt.ylabel('Y轴')
plt.title('正弦曲线')
plt.legend()
plt.grid(True)
plt.show()
```

### 3.2 散点图

散点图可以帮助我们了解两个变量的关系。

```python
x = np.array([5550, 7500, 10500, 15000, 20000, 25000, 30000, 40000])
y = np.array([800, 1800, 1250, 2000, 1800, 2100, 2500, 3500])

plt.figure(figsize=(6, 4), dpi=120)
plt.scatter(x, y, s=100, alpha=0.6)
plt.xlabel('收入')
plt.ylabel('支出')
plt.title('收入与支出关系')
plt.show()
```

### 3.3 柱状图

在对比数据的差异时，柱状图是非常棒的选择。

```python
x = np.arange(4)
y1 = np.random.randint(20, 50, 4)
y2 = np.random.randint(10, 60, 4)

plt.figure(figsize=(6, 4), dpi=120)
plt.bar(x - 0.1, y1, width=0.2, label='销售A组')
plt.bar(x + 0.1, y2, width=0.2, label='销售B组')
plt.xticks(x, labels=['Q1', 'Q2', 'Q3', 'Q4'])
plt.legend()
plt.show()
```

### 3.4 饼图

饼图用于展示数据构成。

```python
data = np.random.randint(100, 500, 7)
labels = ['苹果', '香蕉', '桃子', '荔枝', '石榴', '山竹', '榴莲']

plt.figure(figsize=(5, 5), dpi=120)
plt.pie(data, labels=labels, autopct='%.1f%%', startangle=90)
plt.title('水果销售额占比')
plt.show()
```

### 3.5 直方图

直方图用于展示数据分布。

```python
data = np.random.normal(100, 15, 1000)

plt.figure(figsize=(6, 4), dpi=120)
plt.hist(data, bins=30, edgecolor='black')
plt.xlabel('数值')
plt.ylabel('频数')
plt.title('数据分布直方图')
plt.show()
```

### 3.6 箱线图

箱线图用于查找离群值。

```python
data = np.random.randint(1, 100, 10)

plt.figure(figsize=(6, 4), dpi=120)
plt.boxplot(data, showmeans=True)
plt.ylabel('数值')
plt.title('箱线图')
plt.show()
```

## 4. 高级图表

### 4.1 气泡图

气泡图可以用来了解三个变量之间的关系。

```python
income = np.array([5550, 7500, 10500, 15000, 20000, 25000, 30000, 40000])
outcome = np.array([800, 1800, 1250, 2000, 1800, 2100, 2500, 3500])
nums = np.array([5, 3, 10, 5, 12, 20, 8, 10])

plt.figure(figsize=(6, 4), dpi=120)
plt.scatter(income, outcome, s=nums * 30, c=nums, cmap='Reds', alpha=0.6)
plt.colorbar()
plt.xlabel('收入')
plt.ylabel('支出')
plt.title('收入、支出与次数关系')
plt.show()
```

### 4.2 面积图

面积图又叫堆叠折线图，用于展示趋势和对比。

```python
days = np.arange(7)
sleeping = [7, 8, 6, 6, 7, 8, 10]
eating = [2, 3, 2, 1, 2, 3, 2]
working = [7, 8, 7, 8, 6, 2, 3]
playing = [8, 5, 9, 9, 9, 11, 9]

plt.figure(figsize=(8, 4), dpi=120)
plt.stackplot(days, sleeping, eating, working, playing, 
              labels=['睡觉', '吃饭', '工作', '玩耍'])
plt.xticks(days, labels=['周一', '周二', '周三', '周四', '周五', '周六', '周日'])
plt.legend(loc='upper left')
plt.title('一周时间分配')
plt.show()
```

### 4.3 雷达图

雷达图用于比较多个定量数据。

```python
labels = np.array(['速度', '力量', '经验', '防守', '发球', '技术'])
values = np.array([93, 95, 98, 92, 96, 97])
angles = np.linspace(0, 2 * np.pi, labels.size, endpoint=False)

# 闭合图形
values = np.append(values, values[0])
angles = np.append(angles, angles[0])

plt.figure(figsize=(4, 4), dpi=120)
ax = plt.subplot(projection='polar')
plt.plot(angles, values, 'o-', linewidth=2)
plt.fill(angles, values, alpha=0.25)
plt.xticks(angles[:-1], labels)
plt.title('能力雷达图')
plt.show()
```

## 5. 多子图

### 5.1 使用subplot

```python
plt.figure(figsize=(10, 6), dpi=120)

# 第1个子图
plt.subplot(2, 2, 1)
plt.plot(x, y1)
plt.title('图1')

# 第2个子图
plt.subplot(2, 2, 2)
plt.plot(x, y2)
plt.title('图2')

# 第3个子图
plt.subplot(2, 2, 3)
plt.bar(x, y)
plt.title('图3')

# 第4个子图
plt.subplot(2, 2, 4)
plt.scatter(x, y)
plt.title('图4')

plt.tight_layout()
plt.show()
```

### 5.2 使用subplots

```python
fig, axes = plt.subplots(2, 2, figsize=(10, 6), dpi=120)

axes[0, 0].plot(x, y1)
axes[0, 0].set_title('图1')

axes[0, 1].plot(x, y2)
axes[0, 1].set_title('图2')

axes[1, 0].bar(x, y)
axes[1, 0].set_title('图3')

axes[1, 1].scatter(x, y)
axes[1, 1].set_title('图4')

plt.tight_layout()
plt.show()
```

## 6. 图表定制

### 6.1 标题和标签

```python
plt.title('图表标题', fontsize=14, fontweight='bold')
plt.xlabel('X轴标签', fontsize=12)
plt.ylabel('Y轴标签', fontsize=12)
```

### 6.2 图例

```python
plt.legend(loc='upper right', fontsize=10)
```

### 6.3 网格

```python
plt.grid(True, linestyle='--', alpha=0.5)
```

### 6.4 坐标轴

```python
plt.xlim(0, 10)
plt.ylim(0, 100)
plt.xticks([0, 2, 4, 6, 8, 10])
plt.yticks([0, 20, 40, 60, 80, 100])
```

## 7. Seaborn

### 7.1 安装和导入

```bash
pip install seaborn
```

```python
import seaborn as sns
sns.set_theme()
```

### 7.2 分布图

```python
# 直方图
sns.histplot(data=df, x='列名', kde=True)

# 密度图
sns.kdeplot(data=df, x='列名')

# 箱线图
sns.boxplot(data=df, x='类别', y='数值')
```

### 7.3 关系图

```python
# 散点图
sns.scatterplot(data=df, x='列1', y='列2', hue='类别')

# 回归图
sns.regplot(data=df, x='列1', y='列2')

# 点对图
sns.pairplot(data=df, hue='类别')
```

### 7.4 分类图

```python
# 柱状图
sns.barplot(data=df, x='类别', y='数值')

# 小提琴图
sns.violinplot(data=df, x='类别', y='数值')

# 热力图
sns.heatmap(df.corr(), annot=True, cmap='coolwarm')
```

## 8. PyEcharts

### 8.1 安装和导入

```bash
pip install pyecharts
```

```python
from pyecharts.charts import Bar, Pie, Line
from pyecharts import options as opts
```

### 8.2 柱状图

```python
bar = Bar()
bar.add_xaxis(['A', 'B', 'C', 'D'])
bar.add_yaxis('数值', [10, 20, 30, 40])
bar.set_global_opts(title_opts=opts.TitleOpts(title="柱状图"))
bar.render('bar.html')
```

### 8.3 饼图

```python
pie = Pie()
pie.add("", [list(z) for z in zip(['A', 'B', 'C'], [10, 20, 30])])
pie.set_global_opts(title_opts=opts.TitleOpts(title="饼图"))
pie.render('pie.html')
```

## 9. Pandas绘图

### 9.1 Series绘图

```python
ser = pd.Series([10, 20, 30, 40], index=['A', 'B', 'C', 'D'])
ser.plot(kind='bar')
plt.show()
```

### 9.2 DataFrame绘图

```python
df = pd.DataFrame({
    'A': [10, 20, 30, 40],
    'B': [15, 25, 35, 45]
}, index=['Q1', 'Q2', 'Q3', 'Q4'])

df.plot(kind='bar')
df.plot(kind='line')
df.plot(kind='area')
plt.show()
```

## 10. 图表保存

### 10.1 保存为图片

```python
plt.savefig('chart.png', dpi=300, bbox_inches='tight')
```

### 10.2 保存为PDF

```python
plt.savefig('chart.pdf', bbox_inches='tight')
```

## 11. 最佳实践

1. **选择合适的图表类型**：根据数据特点选择合适的图表
2. **保持简洁**：避免过度装饰，突出数据本身
3. **使用颜色**：合理使用颜色增强可读性
4. **添加标签**：为图表添加清晰的标题和标签
5. **注意比例**：保持图表的比例和尺度合理

## 12. 总结

数据可视化是数据分析的重要环节，通过图表可以直观地展示数据特征和规律。Matplotlib 是 Python 最基础的可视化库，Seaborn 提供了更高级的统计图表，PyEcharts 适合制作交互式图表。掌握这些工具的使用方法，可以有效地将数据分析结果呈现给他人。

