# 特征工程

> 特征工程是机器学习成功的关键步骤

## 1. 特征工程概述

特征工程包括：
- 特征选择
- 特征变换
- 特征创建
- 特征编码

## 2. 特征选择

### 2.1 相关性分析

```python
import pandas as pd
import numpy as np

# 计算相关性
correlation = df.corr()
print(correlation)

# 选择高相关性特征
high_corr_features = correlation[correlation > 0.8].stack().reset_index()
high_corr_features = high_corr_features[high_corr_features[0] != 1.0]
```

### 2.2 特征重要性

```python
from sklearn.ensemble import RandomForestClassifier
from sklearn.feature_selection import SelectFromModel

# 训练模型获取特征重要性
model = RandomForestClassifier()
model.fit(X, y)

# 选择重要特征
selector = SelectFromModel(model, threshold='median')
X_selected = selector.fit_transform(X, y)
```

### 2.3 方差过滤

```python
from sklearn.feature_selection import VarianceThreshold

# 移除低方差特征
selector = VarianceThreshold(threshold=0.01)
X_selected = selector.fit_transform(X)
```

## 3. 特征变换

### 3.1 对数变换

```python
# 处理偏态分布
df['log_feature'] = np.log1p(df['feature'])
```

### 3.2 标准化和归一化

```python
from sklearn.preprocessing import StandardScaler, MinMaxScaler

# 标准化
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# 归一化
min_max_scaler = MinMaxScaler()
X_normalized = min_max_scaler.fit_transform(X)
```

### 3.3 分箱

```python
# 等宽分箱
df['age_bin'] = pd.cut(df['age'], bins=5, labels=['低', '中低', '中', '中高', '高'])

# 等频分箱
df['age_bin'] = pd.qcut(df['age'], q=5, labels=['低', '中低', '中', '中高', '高'])
```

## 4. 特征创建

### 4.1 组合特征

```python
# 数值特征组合
df['total'] = df['feature1'] + df['feature2']
df['product'] = df['feature1'] * df['feature2']
df['ratio'] = df['feature1'] / df['feature2']

# 类别特征组合
df['category_combo'] = df['cat1'] + '_' + df['cat2']
```

### 4.2 时间特征

```python
df['year'] = df['date'].dt.year
df['month'] = df['date'].dt.month
df['day_of_week'] = df['date'].dt.dayofweek
df['is_weekend'] = df['date'].dt.dayofweek >= 5
```

### 4.3 文本特征

```python
# 文本长度
df['text_length'] = df['text'].str.len()

# 词数
df['word_count'] = df['text'].str.split().str.len()

# 特殊字符数
df['special_chars'] = df['text'].str.count(r'[!@#$%^&*()]')
```

## 5. 特征编码

### 5.1 One-Hot编码

```python
df_encoded = pd.get_dummies(df, columns=['category'], prefix='cat')
```

### 5.2 Label编码

```python
from sklearn.preprocessing import LabelEncoder

le = LabelEncoder()
df['category_encoded'] = le.fit_transform(df['category'])
```

### 5.3 Target编码

```python
# 基于目标变量的编码
target_mean = df.groupby('category')['target'].mean()
df['category_target_encoded'] = df['category'].map(target_mean)
```

## 6. 总结

特征工程要点：
- **特征选择**：相关性、重要性、方差
- **特征变换**：对数、标准化、分箱
- **特征创建**：组合、时间、文本特征
- **特征编码**：One-Hot、Label、Target编码

良好的特征工程可以显著提升模型性能。

