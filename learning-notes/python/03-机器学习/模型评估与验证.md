# 模型评估与验证

> 机器学习模型评估方法和验证策略

## 1. 评估指标

### 1.1 分类指标

```python
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score
from sklearn.metrics import confusion_matrix, classification_report

y_true = [0, 1, 0, 1, 1, 0]
y_pred = [0, 1, 0, 1, 0, 1]

# 准确率
accuracy = accuracy_score(y_true, y_pred)

# 精确率
precision = precision_score(y_true, y_pred)

# 召回率
recall = recall_score(y_true, y_pred)

# F1分数
f1 = f1_score(y_true, y_pred)

# 混淆矩阵
cm = confusion_matrix(y_true, y_pred)

# 分类报告
report = classification_report(y_true, y_pred)
```

### 1.2 ROC和AUC

```python
from sklearn.metrics import roc_curve, auc
import matplotlib.pyplot as plt

y_true = [0, 0, 1, 1]
y_scores = [0.1, 0.4, 0.35, 0.8]

fpr, tpr, thresholds = roc_curve(y_true, y_scores)
roc_auc = auc(fpr, tpr)

plt.plot(fpr, tpr, label=f'ROC (AUC = {roc_auc:.2f})')
plt.plot([0, 1], [0, 1], 'k--')
plt.xlabel('False Positive Rate')
plt.ylabel('True Positive Rate')
plt.title('ROC Curve')
plt.legend()
plt.show()
```

### 1.3 回归指标

```python
from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score

y_true = [3, -0.5, 2, 7]
y_pred = [2.5, 0.0, 2, 8]

# 均方误差
mse = mean_squared_error(y_true, y_pred)

# 均方根误差
rmse = np.sqrt(mse)

# 平均绝对误差
mae = mean_absolute_error(y_true, y_pred)

# R²分数
r2 = r2_score(y_true, y_pred)
```

## 2. 交叉验证

### 2.1 K折交叉验证

```python
from sklearn.model_selection import cross_val_score, KFold
from sklearn.ensemble import RandomForestClassifier

X, y = load_data()
model = RandomForestClassifier()

# K折交叉验证
kfold = KFold(n_splits=5, shuffle=True, random_state=42)
scores = cross_val_score(model, X, y, cv=kfold, scoring='accuracy')

print(f"平均准确率: {scores.mean():.2f} (+/- {scores.std() * 2:.2f})")
```

### 2.2 分层K折交叉验证

```python
from sklearn.model_selection import StratifiedKFold

skfold = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)
scores = cross_val_score(model, X, y, cv=skfold, scoring='accuracy')
```

### 2.3 留一法交叉验证

```python
from sklearn.model_selection import LeaveOneOut

loo = LeaveOneOut()
scores = cross_val_score(model, X, y, cv=loo)
```

## 3. 学习曲线

### 3.1 绘制学习曲线

```python
from sklearn.model_selection import learning_curve
import matplotlib.pyplot as plt

train_sizes, train_scores, val_scores = learning_curve(
    model, X, y, cv=5, n_jobs=-1,
    train_sizes=np.linspace(0.1, 1.0, 10)
)

train_mean = np.mean(train_scores, axis=1)
train_std = np.std(train_scores, axis=1)
val_mean = np.mean(val_scores, axis=1)
val_std = np.std(val_scores, axis=1)

plt.plot(train_sizes, train_mean, 'o-', label='训练集')
plt.fill_between(train_sizes, train_mean - train_std, train_mean + train_std, alpha=0.1)
plt.plot(train_sizes, val_mean, 'o-', label='验证集')
plt.fill_between(train_sizes, val_mean - val_std, val_mean + val_std, alpha=0.1)
plt.xlabel('训练样本数')
plt.ylabel('准确率')
plt.legend()
plt.show()
```

## 4. 验证曲线

### 4.1 超参数验证

```python
from sklearn.model_selection import validation_curve

param_range = np.logspace(-6, -1, 5)
train_scores, val_scores = validation_curve(
    model, X, y, param_name='C', param_range=param_range, cv=5
)
```

## 5. 总结

模型评估与验证要点：
- **评估指标**：准确率、精确率、召回率、F1、ROC/AUC、MSE、MAE、R²
- **交叉验证**：K折、分层K折、留一法
- **学习曲线**：诊断欠拟合/过拟合
- **验证曲线**：超参数调优

正确的评估方法确保模型泛化能力。

